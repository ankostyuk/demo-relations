API информационной системы Национального кредитного бюро

* [Сущности информационной системы](#Сущности информационной системы)
* [Поиск организаций](#Поиск организаций)
* [Проверка на аффилированность](#Проверка на аффилированность)
* [Балансы организаций](#Балансы организаций)
* [Связи](#Связи)
* [Поиск взаимосвязей](#Поиск взаимосвязей)
* [Пакетная проверка](#Пакетная проверка)


# Термины и определения

Клиент API (Клиент) - организация заключившая договор с Национальным кредитным бюро
на использование API.

ИС НКБ - информационная система Национального кредитного бюро.

ИС Клиента - информационная система Клиента.


# API

Обмен между ИС НКБ и ИС Клиента осуществляется по протоколу HTTPS.

Формат данных обмена - JSON.

Параметры в запроса должны быть в кодировке UTF-8 и [закодированы
для передачи в URL](http://en.wikipedia.org/wiki/Percent-encoding).

ИС Клиента выступает инициатором обмена и является клиентом по отношению к
серверу ИС НКБ.

При ответе на запрос, ИС НКБ может выставить один из перечисленных HTTP статусов:

* 200 OK: Запрос обработан успешно. Тело ответа содержит запрашиваемые данные.
* 400 Bad Request: Запрос содержит некорректные данные.
* 403 Forbidden: Сервер не может авторизовать клиента для выполнения запроса.
* 404 Not Found: Запрашиваемый ресурс не найден.
* 405 Method Not Allowed: Неподдерживаемый HTTP метод.
* 500 Internal Server Error: На сервере произошла ошибка.
* 502 Bad Gateway: Сервер недоступен или обновляется.
* 503 Service Unavailable: Сервер доступен, но перегружен запросами. Необходимо
повторить запрос позже.


## Аутентификация

HTTP Basic over HTTPS


## <a name="Сущности информационной системы">Сущности информационной системы</a>

### Организация

Юридическое лицо, зарегистрированное в РФ.

#### Атрибуты

* `type` - тип в Системе - [строка `COMPANY`, обязателен]
* `id` - идентификатор в Системе - [строка из цифр, обязателен]
* `fullName` - полное наименование - [строка, опционален]
* `shortName` - сокращенное наименование - [строка, опционален]
* `chiefName` - ФИО руководителя или наименование управляющей компании - [строка, опционален]
* `address` - адрес - [строка, опционален]
* `regDate` - дата регистрации - [строка в формате "ГГГГ-ММ-ДД", опционален]
* `inn` - ИНН организации - [строка 10 цифр, опционален]
* `ogrn` - ОГРН организации - [строка из 13 цифр, опционален]
* `okpo` - ОКПО организации - [строка из 8 цифр, обязателен]
* `okopf` - код ОКОПФ - [строка из 5 цифр, опционален]
* `kpp` - КПП - [строка из 9 цифр, опционален]
* `okved` - основной код ОКВЭД - [строка, опционален]
* `okato` - код ОКАТО - [строка, опционален]
* `status` - статус компании - [объект, опционален]
    * `status.type` - статус компании - [строка, опционален]
    * `status.date` - дата актуальности статуса - [строка в формате "ГГГГ-ММ-ДД", опционален]


### ФИО

ФИО физического лица.

#### Атрибуты

* `type` - тип в Системе - [строка `INDIVIDUAL`, обязателен]
* `id` - идентификатор в Системе - [строка, обязателен]
* `name` - Фамилия Имя Отчество - [строка, опционален]

### Адрес

#### Атрибуты

* `type` - тип в Системе - [строка `ADDRESS`, обязателен]
* `id` - идентификатор в Системе - [строка, обязателен]
* `value` - адрес - [строка из цифр, обязателен]
* `index` - почтовый индекс - [строка из цифр, опционален]

### Телефон

#### Атрибуты

* `type` - тип в Системе - [строка `PHONE`, обязателен]
* `id` - идентификатор в Системе - [строка, обязателен]
* `value` - телефон - [строка, обязателен]

### Закупка

Государсвенная или коммерческая закупка.

#### Атрибуты

* `type` - тип в Системе - [строка `PURCHASE`, обязателен]
* `id` - идентификатор в Системе - [строка, обязателен]
* `name` - предмет закупки - [строка, обязателен]
* `form` - форма закупки - [строка, обязателен]
* `date` - дата извещения о закупке - [строка в формате "ГГГГ-ММ-ДД", обязателен]
* `currency` - валюта закупки - [строка, 3-х символьный код валюты, опционален]
* `totalPrice` - первоначальная цена - [число, опционален]
* `etp` - торговая площадка - [строка, опционален]
* `law` - федеральный закон, в соответствии с которым проводилась закупка - [строка, опционален]


## <a name="Поиск организаций">Поиск организаций</a>

### Запрос

`GET /api/company`

### Параметры

* inn [строка 10 цифр, опционален] - ИНН организации
* ogrn [строка из 13 цифр, опционален] - ОГРН организации
* okpo [строка из 8 цифр, опционален] - ОКПО организации
* id [строка из цифр, опционален] - идентификатор организации в Системе
* name [строка, опционален] - наименование организации

В запросе должен быть передан по крайней мере один параметр (ИНН, ОГРН, ОКПО, ID или наименование).
В случае передачи двух и более идентификаторов, поиск будет производиться по соответствию всех переданных идентификаторов.

Если в идентификаторе присутствует ведущий ноль, он также обязателен в запросе,
например поиск по ОКПО 00044428:

`?okpo=00044428`

* subsidiary [флаг, опционален] - учитывать филиалы.

Если значение равно `true`, то при поиске организации по ИНН или ОГРН также будут
найдены ее филиалы, представительства и обособленные подразделения.
Для однозначной идентификации организации, филиала, представительства или
подразделения необходимо использовать код ОКПО или ID организации.

Если значение равно `false`, то при поиске организации исключаются ее филиалы,
представительства и подразделения. При поиске по ИНН или ОГРН будет найдена
только головная организация.

Значение по умолчанию `true`.

Вывод найденных организаций производится постранично, доступны параметры:

* page [целое число, опционален] - номер страницы

значение по умолчанию - 1.

* pageSize [целое число, опционален] - число организаций на одной странице

значение по умолчанию - 10.

Пример:

`?inn=7714611569&subsidiary=false&page=2&pageSize=5`

### Ответ

```json
{
    "total" : "<количество найденных организаций>",
    "pageSize" : "<размер страницы>",
    "pageNumber" : "<номер страницы>",
    "pageCount" : "<общее число страниц>",
    "firstNumber" : "<номер первой организации на текущей странице>",
    "lastNumber" : "<номер последней организации на текущей странице>",
    "list" : [
        {
            "inn" : "<ИНН>",
            "ogrn" : "<ОГРН>",
            "okpo" : "<ОКПО>",
            "id" : "уникальный идентификатор организации в системе",
            "address" : "<адрес>",
            "chiefName" : "<ФИО руководителя или наименование управляющей компании>",
            "fullName" : "<полное наименование>",
            "shortName" : "<сокращенное наименование>",
            "kpp" : "КПП",
            "regDate" : "дата регистрации",
            "status" : {
                "type" : "<статус компании>",
                "date" : "<дата актуальности статуса>"
            },
            "okopf" : "<ОКОПФ>",
            "okved" : "<ОКВЭД>",
            "okato" : "<ОКАТО>"
        },
        {
            "inn" : "<ИНН>",
            "ogrn" : "<ОГРН>",
            "okpo" : "<ОКПО>",
            "id" : "уникальный идентификатор организации в системе",
            "address" : "<адрес>",
            "chiefName" : "<ФИО руководителя или наименование управляющей компании>",
            "fullName" : "<полное наименование>",
            "shortName" : "<сокращенное наименование>",
            "kpp" : "КПП",
            "regDate" : "дата регистрации",
            "status" : {
                "type" : "<статус компании>",
                "date" : "<дата актуальности статуса>"
            },
            "okopf" : "<ОКОПФ>",
            "okved" : "<ОКВЭД>",
            "okato" : "<ОКАТО>"
        },
        ...
    ]
}
```

Ответ содержит следующие поля:

* total [целое число, обязателен] - количество найденных организаций
* pageSize [целое число, обязателен] - размер страницы
* pageNumber [целое число, обязателен] - номер страницы
* pageCount [целое число, обязателен] - номер первой организации на текущей странице
* firstNumber [целое число, обязателен] - номер последней организации на текущей странице
* list [массив элементов, обязателен] - набор карточек организаций на текущей странице

В случае, если не найдено ни одной организации (значение total равно 0),
поле list представляет собой пустой массив.

Каждая карточка организации является объектом [Организация](#Сущности информационной системы)

### Пример №1: Поиск организации по ОГРН с учетом филиалов

`GET https://www.creditnet.ru/nkbrelation/api/company?ogrn=1027700333440`

`200 OK`

```json
{
    "total" : 2,
    "pageSize" : 10,
    "pageNumber" : 1,
    "pageCount" : 1,
    "firstNumber" : 1,
    "lastNumber" : 2,
    "list": [
        {
            "inn" : "7718083616",
            "ogrn" : "1027700333440",
            "okpo" : "17613675",
            "id" : "750397",
            "address" : "г Москва, ул 3-я Рыбинская, д 22",
            "chiefName" : "Дрибный Андрей Николаевич",
            "fullName" : "ОТКРЫТОЕ АКЦИОНЕРНОЕ ОБЩЕСТВО \"ЭКСТРА М\"",
            "shortName" : "ОАО \"ЭКСТРА М\"",
            "kpp" : "771801001",
            "regDate" : "1992-12-16",
            "status" : {
                "type" : "Действующее",
                "date" : "2011-11-09"
            },
            "okopf" : "12247",
            "okved" : "1585",
            "okato" : "45263591000"
        },
        {
            "inn" : "7718083616",
            "ogrn" : "1027700333440",
            "okpo" : "03559966",
            "id" : "9519004",
            "address" : "г Санкт-Петербург, ул Коли Томчака, 21",
            "chiefName" : "Ягмешин Юрий Валентинович",
            "fullName" : "Санкт-Петербургский филиал Открытого акционерного общества \"Экстра М\"",
            "shortName" : "Санкт-Петербургский филиал ОАО \"Экстра м\"",
            "kpp" : "781001001",
            "regDate" : "1993-05-10",
            "status" : {
                "type" : "Действующее",
                "date" : "2015-06-29"
            },
            "okopf" : "30002",
            "okved" : "1585",
            "okato" : "40284561000"
        }
    ]
}
```

### Пример №2: Поиск организации по ОГРН и ОКПО с учетом филиалов

`GET https://www.creditnet.ru/nkbrelation/api/company?ogrn=1027700333440&okpo=17613675`

`200 OK`

```json
{
    "total" : 1,
    "pageSize" : 10,
    "pageNumber" : 1,
    "pageCount" : 1,
    "firstNumber" : 1,
    "lastNumber" : 1,
    "list": [
        {
            "inn" : "7718083616",
            "ogrn" : "1027700333440",
            "okpo" : "17613675",
            "id" : "750397",
            "address" : "г Москва, ул 3-я Рыбинская, д 22",
            "chiefName" : "Дрибный Андрей Николаевич",
            "fullName" : "ОТКРЫТОЕ АКЦИОНЕРНОЕ ОБЩЕСТВО \"ЭКСТРА М\"",
            "shortName" : "Санкт-Петербургский филиал ОАО \"Экстра м\"",
            "kpp" : "781001001",
            "regDate" : "1993-05-10",
            "status" : {
                "type" : "Действующее",
                "date" : "2015-06-29"
            },
            "okopf" : "30002",
            "okved" : "1585",
            "okato" : "40284561000"
        }
    ]
}
```

### Пример №3: Поиск организации по ИНН без учета филиалов

`GET https://www.creditnet.ru/nkbrelation/api/company?inn=7706107510&subsidiary=false`

`200 OK`

```json
{
    "total" : 1,
    "pageSize" : 10,
    "pageNumber" : 1,
    "pageCount" : 1,
    "firstNumber" : 1,
    "lastNumber" : 1,
    "list": [
        {
            "inn" : "7706107510",
            "ogrn" : "1027700043502",
            "okpo" : "00044428",
            "id" : "750397",
            "address" : "г Москва, наб Софийская, д 26/1",
            "chiefName" : "Сечин Игорь Иванович",
            "fullName" : "Открытое акционерное общество \"Нефтяная компания \"Роснефть\"",
            "shortName" : "ОАО \"НК \"Роснефть\"",
            "kpp" : "997150001",
            "regDate" : "1995-12-06",
            "status" : {
                "type" : "Действующее",
                "date" : "2015-06-02"
            },
            "okopf" : "12247",
            "okved" : "111011",
            "okato" : "45286596000"
        }
    ]
}
```

### Пример №4: Поиск организации по наименованию с учетом филиалов

`GET https://www.creditnet.ru/nkbrelation/api/company?name=ЗАО%20"Спецстрой-Лизинг"

`200 OK`

```json
{
    "total" : 1,
    "pageSize" : 10,
    "pageNumber" : 1,
    "pageCount" : 1,
    "firstNumber" : 1,
    "lastNumber" : 1,
    "list": [
        {
            "inn" : "7726687266",
            "ogrn" : "1117746960704",
            "okpo" : "37276659",
            "id" : "8419844",
            "address" : "г Москва, ул Фруктовая, д 5 а",
            "chiefName" : "Лукашевич Наталья Геннадьевна",
            "fullName" : "Закрытое акционерное общество \"Спецстрой-Лизинг\"",
            "shortName" : "ЗАО \"Спецстрой-Лизинг\"",
            "kpp" : "772601001",
            "regDate" : "2011-11-27",
            "status" : {
                "type" : "Действующее",
                "date" : "2013-10-18"
            },
            "okopf" : "12267",
            "okved" : "6521",
            "okato" : "45296575000"
        }
    ]
}
```

### Пример №5: Поиск организации по ОГРН с учетом филиалов вернул пустой результат поиска

`GET https://www.creditnet.ru/nkbrelation/api/company?ogrn=1237700123000`

`200 OK`

```json
{
    "total" : 0,
    "pageSize" : 10,
    "pageNumber" : 1,
    "pageCount" : 0,
    "firstNumber" : 0,
    "lastNumber" : 0,
    "list": [ ]
}
```



## <a name="Проверка на аффилированность">Проверка на аффилированность</a>

### Запрос

`GET /api/connections`

### Параметры

* q [строка, опционален] - идентификатор организации: ОКПО, ИНН или ОГРН.
* i [строка, опционален] - идентификатор физического лица - Фамилия имя и отчество полностью (ФИО),
например *Костюк Андрей Григорьевич*. Значение параметра нечувствительно к регистру символов.

Для осуществления проверки необходимо передать два или более значения -
идентификатора организации или ФИО, при этом по каждой организации ожидается
только один идентификатор.

Пример:

`?q=60510227&q=1117746960704&q=7703561549&i=Костюк+Андрей+Григорьевич&i=Малеев+Владимир+Иванович`

Несколько идентификаторов организаций можно передать в одном параметре `q`, а
несколько ФИО - в одном параметре `i`. Для этого необходимо разделить их символом
перевода строки (ASCII код `0x0A`):

Пример:

`?q=60510227%0A1117746960704%0A7703561549&i=Костюк+Андрей+Григорьевич%0AМалеев+Владимир+Иванович`

* subsidiary [флаг, опционален] - учитывать филиалы.

Если значение равно `true`, то при поиске организации по ИНН или ОГРН также будут
найдены ее филиалы, представительства и обособленные подразделения.
Для однозначной идентификации организации, филиала, представительства или
подразделения необходимо использовать код ОКПО.

Если значение равно `false`, то при поиске организации исключаются ее филиалы,
представительства и подразделения. При поиске по ИНН или ОГРН будет найдена
только головная организация.

Значение по умолчанию `true`.

### Ответ

```json
{
    "connections": [
        ["<идентификатор11>", "<идентификатор12>", ..., "<идентификатор1N>"],
        ["<идентификатор21>", "<идентификатор22>", ..., "<идентификатор2M>"],
        ...
    ],
    "validation": {
        "<идентификаторX>": {"status": "<статусX>", "info": <инфоX>},
        "<идентификаторY>": {"status": "<статусY>", "info": <инфоY>},
        ...
    }
}
```

Ответ содержит набор групп аффилированных лиц `"connections"`.
В каждой группе перечислены идентификаторы, между которыми были выявлены признаки
аффилированности. Каждый идентификатор может принадлежать только одной группе
аффилированных лиц.

В примерах используются идентификаторы организаций:

* 60510227 - ООО "Газэнергоинформ", ОГРН 1097746173249, ИНН 7728696530, ОКПО *60510227*
* 1117746960704 - ЗАО "Спецстрой-Лизинг", ОГРН *1117746960704*, ИНН 7726687266, ОКПО 37276659
* 7703561549 - ООО "Фабрикант.ру", ОГРН: 1057748006139, ИНН *7703561549*, ОКПО 78522076
* 1047796089450 - ООО "ЮВЕНТА", ОГРН *1047796089450*, ИНН 7724505200, ОКПО 72066223
* 1127746519900 - ООО "НАЛПОИНТЕР", ОГРН *1127746519900*, ИНН 7704811150, ОКПО 9933928
* 1057747690890 - ЗАО "НКБ", ОГРН *1057747690890*, ИНН 7714611569, ОКПО 78486593

и идентификаторы физических лиц:

* *Малеев Владимир Иванович* - генеральный директор ЗАО "НКБ"
* *Костюк Андрей Григорьевич* - генеральный директор ООО "НАЛПОИНТЕР"

Если в запросе есть некорректные идентификаторы, ответ будет содержать объект
`"validation"` с описанием выявленных проблем. Ключами в объекте являются
некорректные идентификаторы, а значениями - описания проблем.

Для каждого некорректного идентификатора, описание проблемы представляет собой
объект с двумя полями - обязательной строкой `"status"` и необязательным объектом
`"info"` и может принимать одно из следующих значений:

* `{"status": "NOT_FOUND"}` - идентификатор не найден в ИС НКБ. Идентификатор не участвует в проверке.
* `{"status": "MULTIPLE", "info": <количество совпадений>}` - по идентификатору найдено несколько записей в ИС НКБ.
Идентификатор не участвует в проверке. Объект `"info"` содержит количество записей с заданным идентификатором.
* `{"status": "ALIAS", "info": "<идентификатор>"}` - идентификатор встречается в
запросе больше одного раза или является иным уникальным идентификатором записи
участвующей в проверке. Объект `"info"` содержит строку-идентификатор этой записи.


### Пример №1: Выявлены признаки аффилированности среди всех участников

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=60510227&q=1117746960704&q=7703561549`

`200 OK`

```json
{
    "connections": [
        ["60510227", "1117746960704", "7703561549"]
    ]
}
```

Запрос на проверку аффилированности между организациями

ООО "Газэнергоинформ", ЗАО "Спецстрой-Лизинг" и ООО "Фабрикант.ру"

выявил одну группу аффилированных лиц, содержащую все запрошенные идентификаторы.


### Пример №2: Выявлены признаки аффилированности среди некоторых участников

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=1117746960704&q=7703561549&q=1127746519900`

`200 OK`

```json
{
    "connections": [
        ["1117746960704", "7703561549"]
    ]
}
```

Запрос на проверку аффилированности между организациями

ЗАО "Спецстрой-Лизинг", ООО "Фабрикант.ру" и ООО "НАЛПОИНТЕР"

выявил одну группу аффилированных лиц:

ЗАО "Спецстрой-Лизинг" и ООО "Фабрикант.ру"


### Пример №3: Выявлено несколько групп с признаками аффилированности

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=1117746960704&q=7703561549&q=1127746519900&q=1057747690890`

`200 OK`

```json
{
    "connections": [
        ["1117746960704", "7703561549"],
        ["1127746519900", "1057747690890"],
    ]
}
```

Запрос на проверку аффилированности между организациями

ЗАО "Спецстрой-Лизинг", ООО "Фабрикант.ру", ООО "НАЛПОИНТЕР" и ЗАО "НКБ"

выявил две группы аффилированных лиц:

ЗАО "Спецстрой-Лизинг" и ООО "Фабрикант.ру"
ООО "НАЛПОИНТЕР" и ЗАО "НКБ"


### Пример №4: Признаки аффилированности не выявлены

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=1117746960704&q=1047796089450&q=1127746519900`

`200 OK`

```json
{
}
```

Запрос на проверку аффилированности между тремя организациями

ЗАО "Спецстрой-Лизинг", ООО "ЮВЕНТА" и ООО "НАЛПОИНТЕР"

не выявил признаков аффилированности - ответ не содержит массива `"connections"`


### Пример №5: Один идентификатор в запросе

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=1117746960704`

`400 Bad Request`

```json
{
}
```

Ответ имеет статус `400 Bad Request`, т.к. запрос на проверку аффилированности
должен содержать идентификаторы двух или более организаций.


### Пример №6: Несколько идентификаторов по одной организации

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=1117746960704&q=7726687266&q=37276659&q=1127746519900`

`200 OK`

```json
{
    "validation": {
        "7726687266": {"status": "ALIAS", "info": "1117746960704"},
        "37276659": {"status": "ALIAS", "info": "1117746960704"},
    }
}
```

Запрос на проверку аффилированности между организациями

ЗАО "Спецстрой-Лизинг" и ООО "НАЛПОИНТЕР"

не выявил признаков аффилированности - ответ не содержит массива `"connections"`

Запрос содержит несколько идентификаторов (ОГРН, ИНН и ОКПО) ЗАО "Спецстрой-Лизинг"
- ответ содержит объект `"validation"` с описанием проблем по идентификаторам
`"7726687266"` и `"37276659"` - эти идентификаторы являются иными идентификаторами
ЗАО "Спецстрой-Лизинг".


### Пример №7: Идентификатор не найден в ИС НКБ

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=987654321&q=1117746960704&q=7703561549`

`200 OK`

```json
{
    "connections": [
        ["1117746960704", "7703561549"],
    ],
    "validation": {
        "987654321": {"status": "NOT_FOUND"}
    }
}
```

Запрос на проверку аффилированности между организациями

с идентификатором `"987654321"`, ЗАО "Спецстрой-Лизинг" и ООО "Фабрикант.ру"

выявил одну группу аффилированных лиц:

ЗАО "Спецстрой-Лизинг" и ООО "Фабрикант.ру"

Ответ содержит объект `"validation"` с описанием проблемы по идентификатору
`"987654321"` - идентификатор не найден в ИС НКБ.


### Пример №8: Один корректный идентификатор в запросе

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=987654321&q=1127746519900`

`400 Bad Request`

```json
{
    "validation": {
        "987654321": {"status": "NOT_FOUND"}
    }
}
```

Запрос на проверку аффилированности между организациями

с идентификатором `"987654321"` и ООО "НАЛПОИНТЕР"

вернул статус `400 Bad Request` т.к. содержит только один корректный идентификатор.

Ответ содержит объект `"validation"` с описанием проблемы по идентификатору
`"987654321"` - идентификатор не найден в ИС НКБ.


### Пример №9: Неоднозначный идентификатор

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=7708503727&q=1047796089450&q=1127746519900`

`200 OK`

```json
{
    "validation": {
        "7708503727": {"status": "MULTIPLE", "info": 4480}
    }
}
```

Запрос на проверку аффилированности между организациями

ООО "ЮВЕНТА" и ООО "НАЛПОИНТЕР"

не выявил признаков аффилированности - ответ не содержит массива `"connections"`

Ответ содержит объект `"validation"` с описанием проблемы по идентификатору
`"7708503727"` - по идентификатору найдено 4480 организаций.


### Пример №10: Выявлены признаки аффилированности между участниками-физическими лицами

`GET https://www.creditnet.ru/nkbrelation/api/connections?i=Костюк+Андрей+Григорьевич&i=Малеев+Владимир+Иванович`

`200 OK`

```json
{
    "connections": [
        ["Костюк Андрей Григорьевич", "Малеев Владимир Иванович"]
    ]
}
```

Запрос на проверку аффилированности между ФИО

Костюк Андрей Григорьевич и Малеев Владимир Иванович

выявил признаки аффилированности между ними.


### Пример №11: Выявлены признаки аффилированности между организацией и физическим лицом

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=1057747690890&i=Малеев+Владимир+Иванович`

`200 OK`

```json
{
    "connections": [
        ["1057747690890", "Малеев Владимир Иванович"]
    ]
}
```

Запрос на проверку аффилированности между

ЗАО "НКБ" и Малеев Владимир Иванович

выявил признаки аффилированности между ними.


### Пример №12: Исключение филиалов

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=1027700043502&i=Сечин+Игорь+Иванович&subsidiary=false`

`200 OK`

```json
{
    "connections": [
        ["1027700043502", "Сечин Игорь Иванович"]
    ]
}
```

Запрос на проверку аффилированности между

ОАО "НК "Роснефть" (ОГРН *1027700043502*) и Сечин Игорь Иванович

выявил признаки аффилированности между ними.


### Пример №13: Исключение филиалов не выполняется

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=1027700043502&i=Сечин+Игорь+Иванович&subsidiary=true`

`400 Bad Request`

```json
{
    "validation": {
        "1027700043502": {"status": "MULTIPLE", "info": 12}
    }
}
```

Запрос на проверку аффилированности между

ОАО "НК "Роснефть" (ОГРН *1027700043502*) и Сечин Игорь Иванович

вернул статус `400 Bad Request` т.к. содержит только один корректный идентификатор.

Ответ содержит объект `"validation"` с описанием проблемы по идентификатору
`"1027700043502"` - найдено несколько (12) записей в ИС НКБ.


## <a name="Балансы организаций">Балансы организаций</a>

### Запрос

`GET /balance/{id}`

### Параметры

* id [строка из цифр, обязателен] - ID организации в системе

Пример:

`/balance/981303`

### Ответ

```json
{
    "год1" : {
        "код1" : {
            "value" : "сумма1"
        },
        "код2" : {
            "value" : "сумма2"
        },
        ...
    },
    "год2" : {
        "код1" : {
            "value" : "сумма1"
        },
        "код2" : {
            "value" : "сумма2"
        },
        ...
    },
    ...
}
```

Ответ содержит набор значений балансов по каждому году, причем ключом является год,
а значением - набор объектов, у каждого из которых ключом является код баланса, а значением -
объект содержащий сумму в рублях по данному коду.

### Пример №1: Поиск балансов организации

`GET https://www.creditnet.ru/nkbrelation/api/balance/981308`

`200 OK`

```json
{
    "2000" : {
        "11104" : {
            "value" : 369000
        },
        "11204" : {
            "value" : 207115000
        },
        ...
    },
    "2001" : {
        "11103" : {
            "value" : 369000
        },
        "11104" : {
            "value" : 77000
        },
        ...
    },
    ...
}
```

### Пример №2: Поиск балансов вернул пустой ответ

`GET https://www.creditnet.ru/nkbrelation/api/balance/9813`

`200 OK`

```
{}
```

## <a name="Связи">Связи</a>

Получение связей первого уровня объекта в Системе.

У каждого объекта Системы имеется информация о связях первого уровня с другими объектами, данная информация находится в атрибуте `info`:

```
{
    "in": {
        "<тип входящей связи 1>": {
            "actual": <число>,
            "outdated": <число>
        },
        ...
        "<тип входящей связи N>": {
            "actual": <число>,
            "outdated": <число>
        }
    },
    "out": {
        "<тип исходящей связи 1>": {
            "actual": <число>,
            "outdated": <число>
        },
        ...
        "<тип исходящей связи N>": {
            "actual": <число>,
            "outdated": <число>
        }
    }
}
```

где:

* `in` - входящие связи объекта
* `out` - исходящие связи объекта
* `actual` - количество актуальных связей конкретного типа
* `outdated` - количество исторических связей конкретного типа

### Соответствие связей

Связь | Тип связи | Направление связи
:--- | :--- | :---
Учредители ЮЛ | `FOUNDER_COMPANY` | `in`
Учрежденные ЮЛ организации | `FOUNDER_COMPANY` | `out`
Учредители ФЛ | `FOUNDER_INDIVIDUAL` | `in`
Учрежденные ФЛ организации | `FOUNDER_INDIVIDUAL` | `out`
Головная организация ЮЛ | `HEAD_COMPANY` | `in`
Филиалы ЮЛ | `HEAD_COMPANY` | `out`
Управляющая организация ЮЛ | `EXECUTIVE_COMPANY` | `in`
Управляемые ЮЛ организации | `EXECUTIVE_COMPANY` | `out`
Руководители ЮЛ | `EXECUTIVE_INDIVIDUAL` | `in`
Руководимые ФЛ организации | `EXECUTIVE_INDIVIDUAL` | `out`
Аффилированные организации ЮЛ | `AFFILIATED_COMPANY` | `in`
Зависимые (аффилированные) от ЮЛ организации | `AFFILIATED_COMPANY` | `out`
Аффилированные ФЛ ЮЛ | `AFFILIATED_INDIVIDUAL` | `in`
Зависимые (аффилированные) от ФЛ организации | `AFFILIATED_INDIVIDUAL` | `out`
Предшественники ЮЛ | `PREDECESSOR_COMPANY` | `in`
Правопреемники ЮЛ | `PREDECESSOR_COMPANY` | `out`
Реестродержатель ЮЛ | `REGISTER_HOLDER` | `in`
Эмитенты ЮЛ | `REGISTER_HOLDER` | `out`
Адреса ЮЛ | `ADDRESS` | `in`
Организации по данному адресу | `ADDRESS` | `out`
Телефоны ЮЛ | `PHONE` | `in`
Организации по данному телефону | `PHONE` | `out`
Контактные лица организации | `EMPLOYEE` | `in`
Организации, где ФЛ является контактным лицом | `EMPLOYEE` | `out`
Заказчик закупки | `CUSTOMER_COMPANY` | `in`
Закупки, где ЮЛ является заказчиком | `CUSTOMER_COMPANY` | `out`
Участник закупки ЮЛ | `PARTICIPANT_COMPANY` | `in`
Закупки, где ЮЛ является участником | `PARTICIPANT_COMPANY` | `out`
Участник закупки ФЛ | `PARTICIPANT_INDIVIDUAL` | `in`
Закупки, где ФЛ является участником | `PARTICIPANT_INDIVIDUAL` | `out`
Член комиссии закупки | `COMMISSION_MEMBER` | `in`
Закупки, где ФЛ является членом комиссии | `COMMISSION_MEMBER` | `out`

### Получение связей первого уровня

#### Запрос

`GET /api/<type>/<id>/related/<relType>/<direction>/?history=<...>`

##### Параметры

* `type` - тип объекта в Системе - [обязателен, см. [Сущности информационной системы](#Сущности информационной системы)]
* `id` - идентификатор объекта в Системе - [обязателен, см. [Сущности информационной системы](#Сущности информационной системы)]
* `relType` - тип связи - [обязателен, см. [Соответствие связей](#)]
* `direction` - направление связи - [обязателен, см. [Соответствие связей](#)]
* `history` - наличие в ответе исторических связей - [строка `true | false`, опционален]
    * параметр отсутствует - в ответе все связи, как актуальные, так и исторические
    * `false` - в ответе только актуальные связи
    * `true` - в ответе только исторические связи

#### Ответ

Связанные объекты первого уровня с атрибутами связей с исходным объектом.


## <a name="Поиск взаимосвязей">Поиск взаимосвязей</a>

Получение взаимосвязей между двумя объектами в Системе.

### Запрос

`GET /api/<type_1>/<id_1>/relations/<type_2>/<id_2>/?relType=<...>&maxDepth=<...>&history=<...>`

#### Параметры

* `type_1` - тип первого объекта в Системе - [обязателен, см. [Сущности информационной системы](#Сущности информационной системы)]
* `id_1` - идентификатор первого объекта в Системе - [обязателен, см. [Сущности информационной системы](#Сущности информационной системы)]
* `type_2` - тип второго объекта в Системе - [обязателен, см. [Сущности информационной системы](#Сущности информационной системы)]
* `id_2` - идентификатор второго объекта в Системе - [обязателен, см. [Сущности информационной системы](#Сущности информационной системы)]
* `relType` - типы связей, через которые осуществляется поиск взаимосвязей - [`relType=<relType_1>...&relType=<relType_N>`, обязателен, см. [Соответствие связей](#)]
* `maxDepth` - максимальная глубина поиска взамосвязей - [число от 2 до 10, опционален, по умолчанию - 2]
* `history` - наличие в ответе исторических цепочек связей - [строка `true | false`, опционален]
    * параметр отсутствует - в ответе все цепочки связей, как актуальные, так и исторические
    * `false` - в ответе только актуальные цепочки связей
    * `true` - в ответе только исторические цепочки связей

### Ответ

Цепочки связей между исходными объектами с атрибутами связей между парами объектов в каждой цепочке.


## <a name="Пакетная проверка">Пакетная проверка</a>

Получение взаимосвязей в наборе объектов в Системе.

### Заказ на проверку взаимосвязей

#### Запрос

`POST /api/connections/batch`

##### Параметры

```
{
    "list": [{
        "type_1": <тип объекта>,
        "id_1": <идентификатор объекта>
    },
    ...
    {
        "type_N": <тип объекта>,
        "id_N": <идентификатор объекта>
    }],

    "checkOptions": {
        "relTypes": [<relType_1>, ..., <relType_N>],
        "maxDepth": <число>,
        "history": <флаг>
    }
}
```

где:

* `list` - набор объектов для проверки взаимосвязей - [список объектов, обязателен]
    * `list[].type_1..N` - тип объекта в Системе - [обязателен, см. [Сущности информационной системы](#Сущности информационной системы)]
    * `list[].id_1..N` - идентификатор объекта в Системе - [обязателен, см. [Сущности информационной системы](#Сущности информационной системы)]

* `checkOptions` - опции проверки взаимосвязей - [объект, обязателен]
    * `checkOptions.relTypes` - типы связей, через которые осуществляется поиск взаимосвязей - [список строк, обязателен, см. [Соответствие связей](#)]
    * `checkOptions.maxDepth` - максимальная глубина поиска взамосвязей - [число от 2 до 10, опционален, по умолчанию - 2]
    * `checkOptions.history` - наличие в ответе исторических цепочек связей - [строка `true | false`, опционален]
        * параметр отсутствует - в ответе все цепочки связей, как актуальные, так и исторические
        * `false` - в ответе только актуальные цепочки связей
        * `true` - в ответе только исторические цепочки связей

#### Ответ

Идентификатор заказа на проверку взаимосвязей.


### Проверка выполнения заказа на проверку взаимосвязей

#### Запрос

`GET /api/connections/batch/?orderId=<...>`

##### Параметры

* `orderId` - идентификатор заказа на проверку взаимосвязей - [строка, обязателен]

#### Ответ

Если заказ выполнен:

* пары объектов, в которых были выявлены взаимосвязи, с цепочками связей между объектами в паре, с атрибутами связей между парами объектов в каждой цепочке.

Если заказ не выполнен:

* текущий статус заказа
    * `PROGRESS` - проверка взаимосвязей находится в процессе выполнения
    * `ERROR` - при выполнении проверки взаимосвязей произошла ошибка
        * `message` - описание ошибки
